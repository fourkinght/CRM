<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.crm.dao.UserRolesMapper">
	<sql id="sqlWhere">
		<where>
 			<if test="users.us_LoginName !=null and  users.us_LoginName  !=''">
 				and u.Us_LoginName=#{users.us_LoginName}
 			</if>
 			
 			<if test="users.us_PassWord !=null and users.us_PassWord  !=''">
 				and u.Us_PassWord=#{users.us_PassWord}
 			</if>
 		</where>
	</sql>  
	<!-- 角色表，用户表，角色用户关联表  -->
	<resultMap type="UserRoles" id="resultUserRoles"><!-- id:自定义，type:实体类 -->
		<!-- property:字段,column:别名 -->
		<id property="urs_Id" column="urs_Id" />
		<result property="urs_UserId" column="urs_UserId"/>
		<result property="urs_RoleId" column="Urs_RoleId"/>
		<result property="urs_Ext1" column="urs_Ext1"/>
		<result property="urs_Ext2" column="urs_Ext2"/>
	<association property="roles" javaType="roles"><!-- association：表连接， -->
		<id property="rs_Id" column="rs_Id" />
		<result property="rs_Name" column="rs_Name"/>
		<result property="rs_Ext1" column="rs_Ext1"/>
		<result property="rs_Ext2" column="rs_Ext2"/>
	</association>
	<association property="users" javaType="users"> 
		<id property="us_Id" column="us_Id" />
		<result property="us_LoginName" column="us_LoginName"/>
		<result property="us_PassWord" column="us_PassWord"/>
		<result property="us_UserImg" column="us_UserImg"/>
		<result property="us_IsLockout" column="us_IsLockout"/>
		<result property="us_LastLoginTime" column="us_LastLoginTime"/>
		<result property="us_CreateTime" column="us_CreateTime"/>
		<result property="us_PsdWrongNum" column="us_PsdWrongNum"/>
		<result property="us_LockTime" column="us_LockTime"/>
		<result property="us_ProtecEmail" column="us_ProtecEmail"/>
		<result property="us_ProtecMtel" column="us_ProtecMtel"/>
		<result property="us_Ext1" column="us_Ext1"/>
		<result property="us_Ext2" column="us_Ext2"/>
	</association>
	</resultMap>
	
	<select id="selectUserRolesByName" parameterType="UserRoles"  resultMap="resultUserRoles">
		select r.*,u.*,ur.*
		from roles r INNER JOIN users u INNER JOIN userroles ur 
		on ur.Urs_RoleId=r.Rs_Id and ur.Urs_UserId=u.Us_Id
		<where>
			<if test="users.us_LoginName !=null and users.us_LoginName !=''">
				u.Us_LoginName=#{users.us_LoginName}
			</if>
		</where>
	</select>
 	<insert id="insertUserRoles" parameterType="UserRoles">
 		INSERT INTO userroles(Urs_RoleId,Urs_UserId) 
 		VALUES(#{urs_RoleId},#{urs_UserId})
 	</insert>
	<delete id="deleteUserRoles" parameterType="UserRoles">
		delete from userroles 
		where urs_RoleId=#{urs_RoleId} and urs_UserId=#{urs_UserId}
	</delete>
	<select id="selectUserRolesById" parameterType="int" resultType="int">
		select count(1) 
		from userroles
		where urs_UserId=#{usersId}
	</select>
</mapper>